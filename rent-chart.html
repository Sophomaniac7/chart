<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fixed Costs vs Rent – Acceptable Ranges (¥)</title>
<style>
  :root{
    --bg: #0b1020;
    --panel: #0f172a;
    --ink: #e5f0ff;
    --muted: #9fb0d0;
    --grid: #1f2a44;
    --accent: #7dd3fc;
    --line: #60a5fa;
    --ideal: #34d399;

    --red: rgba(239, 68, 68, 0.25);
    --yellow: rgba(234, 179, 8, 0.25);
    --green: rgba(34, 197, 94, 0.25);

    --red-stroke: #ef4444;
    --yellow-stroke: #eab308;
    --green-stroke: #22c55e;

    --card-radius: 16px;
    --shadow: 0 10px 30px rgba(0,0,0,0.35);
  }

  html, body {
    height: 100%;
    background: radial-gradient(1200px 800px at 20% -10%, #12203a 0%, var(--bg) 60%);
    color: var(--ink);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  }

  .wrap {
    max-width: 1100px;
    margin: 28px auto;
    padding: 0 16px;
  }

  header {
    display: grid;
    gap: 8px;
    margin-bottom: 16px;
  }

  h1 {
    margin: 0;
    font-weight: 800;
    letter-spacing: 0.2px;
    font-size: clamp(22px, 2.2vw, 30px);
  }
  .sub {
    color: var(--muted);
    font-size: 14px;
    line-height: 1.4;
  }

  .card {
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: var(--card-radius);
    box-shadow: var(--shadow);
    padding: 16px;
  }

  .stage {
    display: grid;
    grid-template-columns: 1fr 280px;
    gap: 16px;
  }

  @media (max-width: 900px) {
    .stage { grid-template-columns: 1fr; }
  }

  .legend {
    display: grid;
    gap: 12px;
    align-content: start;
  }

  .legend .item{
    display: grid;
    grid-template-columns: 16px 1fr;
    gap: 10px;
    align-items: center;
    font-size: 14px;
    color: var(--muted);
  }

  .swatch {
    width: 16px; height: 16px; border-radius: 4px;
    border: 1px solid rgba(255,255,255,0.2);
  }
  .sw-red { background: var(--red); border-color: var(--red-stroke); }
  .sw-yellow { background: var(--yellow); border-color: var(--yellow-stroke); }
  .sw-green { background: var(--green); border-color: var(--green-stroke); }

  .keyline { height: 1px; background: var(--grid); margin: 6px 0 2px; }

  .note { color: var(--muted); font-size: 13px; line-height: 1.5; }

  .chip {
    display: inline-flex; align-items: center; gap: 8px;
    background: rgba(125, 211, 252, 0.1);
    border: 1px solid rgba(125,211,252,0.35);
    border-radius: 999px;
    padding: 8px 12px;
    font-size: 13px;
    color: var(--ink);
  }

  .chart-wrap{
    position: relative;
    aspect-ratio: 16/10;
    width: 100%;
    min-height: 380px;
  }

  svg {
    width: 100%; height: 100%; display: block;
    overflow: visible;
  }

  .axis text { fill: var(--muted); font-size: 12px; }
  .axis path, .axis line { stroke: var(--grid); stroke-width: 1; }

  .grid line { stroke: var(--grid); stroke-width: 1; }
  .grid .major line { opacity: 0.9 }
  .grid .minor line { opacity: 0.4 }

  .line-main { stroke: var(--line); stroke-width: 2.25; fill: none; }
  .line-ideal { stroke: var(--ideal); stroke-width: 2.25; stroke-dasharray: 6 6; fill: none; }

  .area-red { fill: var(--red); }
  .area-yellow { fill: var(--yellow); }
  .area-green { fill: var(--green); }

  .cursor-line {
    stroke: rgba(255,255,255,0.5);
    stroke-dasharray: 3 6;
    shape-rendering: crispEdges;
  }

  .tooltip {
    position: absolute;
    pointer-events: none;
    background: #0b1226;
    border: 1px solid rgba(255,255,255,0.16);
    border-radius: 10px;
    padding: 10px 12px;
    font-size: 13px;
    color: var(--ink);
    box-shadow: var(--shadow);
    transform: translate(-50%, -110%);
    white-space: nowrap;
  }
  .tooltip .hdr { color: var(--muted); font-size: 12px; margin-bottom: 6px; }
  .row { display: grid; grid-template-columns: auto auto; gap: 10px; align-items: baseline; }
  .kv { color: var(--ink); font-variant-numeric: tabular-nums; }
  .kv .lab { color: var(--muted); margin-right: 6px; }

  .footnote{
    color: var(--muted); font-size: 12px; margin-top: 10px;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Rent vs Initial Fixed Costs (¥) — Acceptable Ranges</h1>
      <div class="sub">
        Threshold line: <span class="chip">x = 4,000,000 − 24·y</span>.
        The dashed line is the “ideal” target (8% less than the threshold).
        Shading: <strong style="color:#ef9a9a">Red</strong> (unacceptable) above threshold,
        <strong style="color:#fde68a">Yellow</strong> between threshold and ideal,
        <strong style="color:#86efac">Green</strong> under ideal.
      </div>
    </header>

    <div class="stage">
      <div class="card">
        <div class="chart-wrap">
          <svg id="chart" role="img" aria-label="Chart of initial fixed costs vs monthly rent in yen"></svg>
          <div id="tooltip" class="tooltip" style="display:none"></div>
        </div>
        <div class="footnote">
          Axes shown for rent from ¥120,000 to ¥160,000 per month, and fixed costs from ¥0 to ¥3,000,000.
          Move your mouse or tap to inspect values.
        </div>
      </div>

      <aside class="card legend" aria-label="Legend and details">
        <div class="item"><span class="swatch sw-red"></span><div><strong>Unacceptable</strong>: Above threshold line</div></div>
        <div class="item"><span class="swatch sw-yellow"></span><div><strong>Caution</strong>: Between threshold and ideal</div></div>
        <div class="item"><span class="swatch sw-green"></span><div><strong>Ideal</strong>: At or below 8% lower than threshold</div></div>
        <div class="keyline"></div>
        <div class="note">
          The threshold line ensures <em>24 months of rent coverage</em> from the fixed cost budget of ¥4,000,000.
          The ideal band adds an 8% buffer (more conservative).
        </div>
        <div class="keyline"></div>
        <div class="note">
          Example points:
          <ul style="margin:8px 0 0 18px; padding:0; line-height:1.5">
            <li>y = ¥120,000 → threshold x = ¥1,120,000; ideal x ≈ ¥1,030,400</li>
            <li>y = ¥160,000 → threshold x = ¥160,000; ideal x ≈ ¥147,200</li>
          </ul>
        </div>
      </aside>
    </div>
  </div>

<script>
(function(){
  // Data domain (as requested)
  const yMin = 120000, yMax = 160000;            // rent (¥ / month) -> horizontal axis
  const xMin = 0,       xMax = 3000000;          // initial fixed costs (¥) -> vertical axis

  // Chart geometry
  const svg = document.getElementById('chart');
  const W = svg.clientWidth || svg.parentElement.clientWidth;
  const H = svg.clientHeight || svg.parentElement.clientHeight;

  // Margins (room for ticks and labels)
  const m = { top: 18, right: 12, bottom: 50, left: 90 };
  const innerW = Math.max(200, W - m.left - m.right);
  const innerH = Math.max(200, H - m.top - m.bottom);

  // Helpers: scales
  const sx = (yVal)=> m.left + ( (yVal - yMin) / (yMax - yMin) ) * innerW; // horizontal scale (rent)
  const sy = (xVal)=> m.top  + innerH - ( (xVal - xMin) / (xMax - xMin) ) * innerH; // vertical scale (fixed costs)

  // Math
  const threshold = (y)=> 4000000 - 24*y;
  const ideal = (y)=> 0.92 * threshold(y); // 8% less

  // Build axes, grid, and labels
  function add(el){ svg.appendChild(el); return el; }
  function E(tag, attrs={}, children=[]){
    const e = document.createElementNS('http://www.w3.org/2000/svg', tag);
    Object.entries(attrs).forEach(([k,v])=> e.setAttribute(k, v));
    children.forEach(c=> e.appendChild(c));
    return e;
  }

  // Background grid
  const grid = add(E('g', {class:'grid'}));
  // Vertical grid (rent)
  const rentTick = 5000; // ¥5k steps for minor; majors at ¥10k
  for(let yv = yMin; yv<=yMax; yv+=rentTick){
    const x = sx(yv);
    const major = (yv % 10000 === 0);
    grid.appendChild(E('line', { x1:x, y1:m.top, x2:x, y2:m.top+innerH, class: major ? 'major' : 'minor' }));
  }
  // Horizontal grid (fixed costs)
  const costTick = 250000; // minor; majors at 500k
  for(let xv = xMin; xv<=xMax; xv+=costTick){
    const y = sy(xv);
    const major = (xv % 500000 === 0);
    grid.appendChild(E('line', { x1:m.left, y1:y, x2:m.left+innerW, y2:y, class: major ? 'major' : 'minor' }));
  }

  // Axes
  const ax = add(E('g', {class:'axis'}));
  // X axis (rent)
  ax.appendChild(E('line', { x1:m.left, y1:m.top+innerH, x2:m.left+innerW, y2:m.top+innerH }));
  // Ticks & labels (every 10k)
  for(let yv=yMin; yv<=yMax; yv+=10000){
    const x = sx(yv);
    ax.appendChild(E('line', { x1:x, y1:m.top+innerH, x2:x, y2:m.top+innerH+6 }));
    const t = E('text', { x:x, y:m.top+innerH+22, 'text-anchor':'middle' });
    t.textContent = '¥' + formatNum(yv);
    ax.appendChild(t);
  }
  const xLab = E('text', { x:m.left + innerW/2, y:m.top+innerH+40, 'text-anchor':'middle' });
  xLab.textContent = 'Rent per Month (¥)';
  ax.appendChild(xLab);

  // Y axis (fixed costs)
  ax.appendChild(E('line', { x1:m.left, y1:m.top, x2:m.left, y2:m.top+innerH }));
  for(let xv=xMin; xv<=xMax; xv+=500000){
    const y = sy(xv);
    ax.appendChild(E('line', { x1:m.left-6, y1:y, x2:m.left, y2:y }));
    const t = E('text', { x:m.left-10, y:y+4, 'text-anchor':'end' });
    t.textContent = '¥' + formatNum(xv);
    ax.appendChild(t);
  }
  const yLab = E('text', { transform:`translate(${m.left-62} ${m.top+innerH/2}) rotate(-90)`, 'text-anchor':'middle' });
  yLab.textContent = 'Initial Fixed Costs (¥)';
  ax.appendChild(yLab);

  // Compute sampled points along domain for smooth paths
  const samples = 400;
  const ys = Array.from({length:samples+1}, (_,i)=> yMin + i*(yMax-yMin)/samples);
  const lineMain = ys.map(y=> [sx(y), sy(threshold(y))]);
  const lineIdeal = ys.map(y=> [sx(y), sy(ideal(y))]);

  const pathD = (pts)=> 'M' + pts.map(p=> p.map(v=> +v.toFixed(2)).join(',')).join(' L ');

  // Shaded regions (polygons) — order: green (bottom), yellow (middle), red (top)
  // GREEN: below ideal down to bottom
  const polyGreen = [
    ...lineIdeal,
    [sx(yMax), sy(xMin)],
    [sx(yMin), sy(xMin)],
  ];
  add(E('path', { d: pathD(polyGreen), class:'area-green' }));

  // YELLOW: between threshold and ideal
  const polyYellow = [
    ...lineMain,
    ...lineIdeal.slice().reverse(),
  ];
  add(E('path', { d: pathD(polyYellow), class:'area-yellow' }));

  // RED: above threshold up to top
  const polyRed = [
    ...lineMain,
    [sx(yMax), sy(xMax)],
    [sx(yMin), sy(xMax)],
  ];
  add(E('path', { d: pathD(polyRed), class:'area-red' }));

  // Lines
  add(E('path', { d: pathD(lineMain), class:'line-main', 'aria-label':'Threshold line: x = 4,000,000 − 24·y' }));
  add(E('path', { d: pathD(lineIdeal), class:'line-ideal', 'aria-label':'Ideal line: 8% less than threshold' }));

  // Cursor line and interaction overlay
  const overlay = add(E('rect', { x:m.left, y:m.top, width:innerW, height:innerH, fill:'transparent', style:'cursor:crosshair' }));
  const cursor = add(E('line', { class:'cursor-line', x1:m.left, x2:m.left, y1:m.top, y2:m.top+innerH, opacity:0 }));

  const tooltip = document.getElementById('tooltip');

  overlay.addEventListener('pointermove', onMove);
  overlay.addEventListener('pointerenter', ()=> { cursor.setAttribute('opacity','1'); tooltip.style.display='block'; });
  overlay.addEventListener('pointerleave', ()=> { cursor.setAttribute('opacity','0'); tooltip.style.display='none'; });

  function onMove(e){
    const pt = clientToSvg(e.clientX, e.clientY);
    const cx = clamp(pt.x, m.left, m.left+innerW);
    cursor.setAttribute('x1', cx);
    cursor.setAttribute('x2', cx);

    const rent = yMin + ( (cx - m.left) / innerW ) * (yMax - yMin);
    const xTh = threshold(rent);
    const xId = ideal(rent);

    const yTh = sy(xTh);
    const yId = sy(xId);

    // Tooltip content
    tooltip.innerHTML = `
      <div class="hdr">At Rent <strong>¥${formatNum(rent,0)}</strong> / mo</div>
      <div class="row"><span class="lab">Threshold x:</span><span class="kv">¥${formatNum(xTh)}</span></div>
      <div class="row"><span class="lab">Ideal x (−8%):</span><span class="kv">¥${formatNum(xId)}</span></div>
    `;

    const ttX = cx;
    const ttY = Math.min(yTh, yId) - 12; // hover near the lower of the two lines
    tooltip.style.left = `${ttX}px`;
    tooltip.style.top = `${ttY}px`;
  }

  // Utility: format ¥ with commas
  function formatNum(n, decimals = 0){
    const fixed = Number(n).toFixed(decimals);
    return Number(fixed).toLocaleString('en-US', { maximumFractionDigits: decimals, minimumFractionDigits: decimals });
  }
  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

  // Convert clientXY to SVG coordinate space
  function clientToSvg(clientX, clientY){
    const pt = svg.createSVGPoint();
    pt.x = clientX; pt.y = clientY;
    const ctm = svg.getScreenCTM().inverse();
    return pt.matrixTransform(ctm);
  }
})();
</script>
</body>
</html>
