<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Rent (¥/mo) vs Initial Fixed Costs (¥)</title>
<style>
  :root{
    --bg: #0b1020;
    --ink: #e8f0ff;
    --muted: #9fb0d0;
    --grid: #1f2a44;
    --line: #60a5fa;
    --ideal: #34d399;

    --red: rgba(239, 68, 68, 0.25);
    --yellow: rgba(234, 179, 8, 0.25);
    --green: rgba(34, 197, 94, 0.25);

    --card-radius: 16px;
    --shadow: 0 10px 30px rgba(0,0,0,0.35);
  }

  html, body { height: 100%; background: radial-gradient(1200px 800px at 20% -10%, #12203a 0%, #091124 60%); color: var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  .wrap { max-width: 1100px; margin: 20px auto; padding: 0 16px; }
  h1 { margin: 0 0 4px; font-size: clamp(20px, 2.2vw, 30px); font-weight: 800; }
  .sub { color: var(--muted); font-size: 14px; line-height: 1.4; }

  .card {
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: var(--card-radius);
    box-shadow: var(--shadow);
    padding: 14px;
  }

  .stage { display: grid; grid-template-columns: 1fr 320px; gap: 16px; }
  @media (max-width: 900px) { .stage { grid-template-columns: 1fr; } }

  .chart-wrap { position: relative; width: 100%; aspect-ratio: 16/11; min-height: 360px; }
  svg { width: 100%; height: 100%; display: block; overflow: visible; }

  .axis text { fill: var(--muted); font-size: 12px; }
  .axis path, .axis line { stroke: var(--grid); stroke-width: 1; }
  .grid line { stroke: var(--grid); stroke-width: 1; }
  .grid .major line { opacity: .9 }
  .grid .minor line { opacity: .4 }

  .line-main { stroke: var(--line); stroke-width: 2.5; fill: none; }
  .line-ideal { stroke: var(--ideal); stroke-width: 2.5; stroke-dasharray: 6 6; fill: none; }

  .area-red { fill: var(--red); }
  .area-yellow { fill: var(--yellow); }
  .area-green { fill: var(--green); }

  .cursor-line { stroke: rgba(255,255,255,.5); stroke-dasharray: 3 6; shape-rendering: crispEdges; }

  .legend { display: grid; gap: 10px; align-content: start; }
  .legend .row { display: grid; grid-template-columns: 16px 1fr; gap: 10px; align-items: center; font-size: 14px; color: var(--muted); }
  .sw { width: 16px; height: 16px; border-radius: 4px; border: 1px solid rgba(255,255,255,.25); }
  .sw.red { background: var(--red); } .sw.yellow { background: var(--yellow); } .sw.green { background: var(--green); }
  .keyline { height: 1px; background: var(--grid); margin: 8px 0; }
  .foot { color: var(--muted); font-size: 12px; margin-top: 8px; }

  /* calculator */
  .calc { display: grid; gap: 10px; }
  .calc label { font-size: 13px; color: var(--muted); }
  .calc input[type="number"]{
    width: 100%;
    background: #0b1226; color: var(--ink);
    border: 1px solid rgba(255,255,255,.18); border-radius: 10px;
    padding: 10px 12px; font-size: 14px;
  }
  .badge { padding: 6px 10px; border-radius: 10px; font-weight: 700; font-size: 12px; display: inline-block; }
  .ok { background: rgba(34,197,94,.18); border: 1px solid rgba(34,197,94,.5); }
  .warn { background: rgba(234,179,8,.18); border: 1px solid rgba(234,179,8,.5); }
  .bad { background: rgba(239,68,68,.18); border: 1px solid rgba(239,68,68,.5); }

  .tooltip {
    position: absolute; pointer-events: none; background: #0b1226;
    border: 1px solid rgba(255,255,255,.16); border-radius: 10px;
    padding: 10px 12px; font-size: 13px; color: var(--ink); box-shadow: var(--shadow);
    transform: translate(8px,-8px);
    white-space: nowrap;
  }
  .marker { fill: white; stroke: #111827; stroke-width: 2; }
</style>
</head>
<body>
<div class="wrap">
  <h1>Rent (¥/mo) vs Initial Fixed Costs (¥)</h1>
  <div class="sub">
    Working budget applies an 8% cut to the total: <span style="padding:.25rem .6rem;border:1px solid rgba(125,211,252,.35);border-radius:999px;background:rgba(125,211,252,.12)">3,680,000 = 0.92 × 4,000,000</span>.
    Main line: <strong>cost = 3,680,000 − 24·rent</strong>. Dashed line is a stricter “ideal” (another −8%).
  </div>

  <div class="stage">
    <div class="card">
      <div class="chart-wrap">
        <svg id="chart" role="img" aria-label="Initial fixed costs versus monthly rent in yen"></svg>
        <div id="tooltip" class="tooltip" style="display:none"></div>
      </div>
      <div class="foot">Axes show rent from ¥120,000 to ¥160,000 (horizontal) and fixed costs from ¥0 to ¥3,000,000 (vertical). Tap/hover to inspect values.</div>
    </div>

    <aside class="card legend">
      <div class="row"><span class="sw red"></span><div><strong>Unacceptable</strong> — Costs above main line</div></div>
      <div class="row"><span class="sw yellow"></span><div><strong>Caution</strong> — Between main and ideal</div></div>
      <div class="row"><span class="sw green"></span><div><strong>Ideal</strong> — At or below ideal line</div></div>
      <div class="keyline"></div>
      <div style="font-size:14px;color:var(--muted);">Calculator</div>
      <div class="calc">
        <label for="rentIn">Rent (¥/mo)</label>
        <input id="rentIn" type="number" min="0" step="1000" value="140000" inputmode="numeric" />
        <div id="readout" style="font-size:14px; line-height:1.6"></div>
      </div>
    </aside>
  </div>
</div>

<script>
(function(){
  // === Ranges ==============================================================
  const rMin = 120000, rMax = 160000;   // rent (X)
  const cMin = 0,       cMax = 3000000; // costs (Y)

  // Budget logic
  const TOTAL = 4000000;
  const WORKING = TOTAL * 0.92;          // 8% off the total
  const mainCost  = (rent)=> WORKING - 24*rent; // main line
  const idealCost = (rent)=> mainCost(rent) * 0.92; // stricter: another 8% down

  // === Chart helpers =======================================================
  const svg = document.getElementById('chart');
  const tooltip = document.getElementById('tooltip');
  let dims = null, marker = null;

  function measure(){
    const W = svg.clientWidth || svg.parentElement.clientWidth;
    const H = svg.clientHeight || svg.parentElement.clientHeight;
    const m = { top: 20, right: 20, bottom: 64, left: 96 };
    if (window.innerWidth < 480) { m.left = 84; m.bottom = 72; }
    return { W,H,m, innerW: Math.max(220, W-m.left-m.right), innerH: Math.max(220, H-m.top-m.bottom) };
  }
  function clear(){ while(svg.firstChild) svg.removeChild(svg.firstChild); }
  function sx(r){ return dims.m.left + ( (r - rMin) / (rMax - rMin) ) * dims.innerW; }
  function sy(c){ return dims.m.top + dims.innerH - ( (c - cMin) / (cMax - cMin) ) * dims.innerH; }
  function add(tag, attrs={}, kids=[]){ const e=document.createElementNS('http://www.w3.org/2000/svg', tag); Object.entries(attrs).forEach(([k,v])=>e.setAttribute(k,v)); kids.forEach(k=>e.appendChild(k)); svg.appendChild(e); return e; }
  function E(tag, attrs={}, kids=[]){ const e=document.createElementNS('http://www.w3.org/2000/svg', tag); Object.entries(attrs).forEach(([k,v])=>e.setAttribute(k,v)); kids.forEach(k=>e.appendChild(k)); return e; }
  const fmt = (n,d=0)=> Number(Number(n).toFixed(d)).toLocaleString('en-US',{minimumFractionDigits:d,maximumFractionDigits:d});
  const clamp = (v,a,b)=> Math.max(a, Math.min(b, v));
  const pathD = (pts)=> 'M'+pts.map(p=>p.map(v=>+v.toFixed(2)).join(',')).join(' L ');

  function render(){
    dims = measure(); clear();
    const { m, innerW, innerH } = dims;

    // Grid
    const grid = add('g', {class:'grid'});
    // vertical grid (rent)
    const rentMinor = 5000, rentMajor = 10000;
    for(let r=rMin; r<=rMax; r+=rentMinor){
      const x = sx(r); const major = (r % rentMajor === 0);
      grid.appendChild(E('line',{x1:x,y1:m.top,x2:x,y2:m.top+innerH,class:major?'major':'minor'}));
    }
    // horizontal grid (costs)
    const costMinor = 250000, costMajor = 500000;
    for(let c=cMin; c<=cMax; c+=costMinor){
      const y = sy(c); const major = (c % costMajor === 0);
      grid.appendChild(E('line',{x1:m.left,y1:y,x2:m.left+innerW,y2:y,class:major?'major':'minor'}));
    }

    // Axes
    const ax = add('g', {class:'axis'});
    // X (rent)
    ax.appendChild(E('line',{x1:m.left,y1:m.top+innerH,x2:m.left+innerW,y2:m.top+innerH}));
    for(let r=rMin; r<=rMax; r+=10000){
      const x = sx(r);
      ax.appendChild(E('line',{x1:x,y1:m.top+innerH,x2:x,y2:m.top+innerH+6}));
      ax.appendChild(E('text',{x:x,y:m.top+innerH+22,'text-anchor':'middle'},[])).textContent = '¥'+fmt(r);
    }
    ax.appendChild(E('text',{x:m.left+innerW/2,y:m.top+innerH+42,'text-anchor':'middle'})).textContent = 'Rent per Month (¥)';

    // Y (costs)
    ax.appendChild(E('line',{x1:m.left,y1:m.top,x2:m.left,y2:m.top+innerH}));
    for(let c=cMin; c<=cMax; c+=500000){
      const y = sy(c);
      ax.appendChild(E('line',{x1:m.left-6,y1:y,x2:m.left,y2:y}));
      ax.appendChild(E('text',{x:m.left-10,y:y+4,'text-anchor':'end'})).textContent = '¥'+fmt(c);
    }
    ax.appendChild(E('text',{transform:`translate(${m.left-68} ${m.top+innerH/2}) rotate(-90)`,'text-anchor':'middle'})).textContent = 'Initial Fixed Costs (¥)';

    // Lines (cost as fn of rent)
    const N=360;
    const rents = Array.from({length:N+1},(_,i)=> rMin + i*(rMax-rMin)/N);
    const mainPts  = rents.map(r=> [ sx(r), sy(mainCost(r)) ]);
    const idealPts = rents.map(r=> [ sx(r), sy(idealCost(r)) ]);

    // Areas
    const greenPoly = [
      ...idealPts,
      [sx(rMax), sy(cMin)],
      [sx(rMin), sy(cMin)]
    ];
    add('path',{d:pathD(greenPoly),class:'area-green'});

    const yellowPoly = [
      ...mainPts,
      ...idealPts.slice().reverse()
    ];
    add('path',{d:pathD(yellowPoly),class:'area-yellow'});

    const redPoly = [
      ...mainPts,
      [sx(rMax), sy(cMax)],
      [sx(rMin), sy(cMax)]
    ];
    add('path',{d:pathD(redPoly),class:'area-red'});

    // Lines on top
    add('path',{d:pathD(mainPts),class:'line-main','aria-label':'Main: cost = 3,680,000 − 24·rent'});
    add('path',{d:pathD(idealPts),class:'line-ideal','aria-label':'Ideal: 8% below main'});

    // Interaction overlay
    const overlay = add('rect',{x:m.left,y:m.top,width:innerW,height:innerH,fill:'transparent',style:'cursor:crosshair'});
    const cursor = add('line',{class:'cursor-line',x1:m.left,x2:m.left,y1:m.top,y2:m.top+innerH,opacity:0});
    overlay.addEventListener('pointerenter',()=>{cursor.setAttribute('opacity','1');tooltip.style.display='block';});
    overlay.addEventListener('pointerleave',()=>{cursor.setAttribute('opacity','0');tooltip.style.display='none';});

    function moveTo(clientX, clientY){
      const p = clientToSvg(clientX, clientY);
      const cx = clamp(p.x, m.left, m.left+innerW);
      const rent = rMin + ((cx - m.left)/innerW) * (rMax - rMin);
      const cTh = mainCost(rent), cId = idealCost(rent);
      cursor.setAttribute('x1', cx); cursor.setAttribute('x2', cx);
      tooltip.innerHTML = `
        <div style="color:var(--muted);font-size:12px;margin-bottom:6px">At Rent <strong>¥${fmt(rent,0)}</strong> / mo</div>
        <div>Cost threshold: <strong>¥${fmt(cTh)}</strong></div>
        <div>Ideal (−8%): <strong>¥${fmt(cId)}</strong></div>
      `;
      tooltip.style.left = (cx + 10) + 'px';
      tooltip.style.top  = (sy(Math.min(cTh,cId)) - 10) + 'px';
    }
    overlay.addEventListener('pointermove',(e)=>moveTo(e.clientX,e.clientY));

    // Calculator marker
    marker = add('circle',{cx:sx(rMin),cy:sy(cMin),r:5,class:'marker',opacity:.95});
    updateForRent(Number(document.getElementById('rentIn').value || 140000));
  }

  function clientToSvg(clientX, clientY){
    const p = svg.createSVGPoint(); p.x=clientX; p.y=clientY;
    const ctm = svg.getScreenCTM().inverse(); return p.matrixTransform(ctm);
  }

  function fmt(n,d=0){ return Number(Number(n).toFixed(d)).toLocaleString('en-US',{minimumFractionDigits:d,maximumFractionDigits:d}); }
  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

  function updateForRent(rent){
    const cTh = mainCost(rent), cId = idealCost(rent);
    // move marker (clamped to viewport)
    if (marker){
      marker.setAttribute('cx', sx(clamp(rent, rMin, rMax)));
      marker.setAttribute('cy', sy(clamp(cTh, cMin, cMax)));
    }
    // readout + quick badges
    const badge = (cost)=> {
      if (cost <= cId) return '<span class="badge ok">Ideal</span>';
      if (cost <= cTh) return '<span class="badge warn">Caution</span>';
      return '<span class="badge bad">Unacceptable</span>';
    };
    document.getElementById('readout').innerHTML = `
      <div>Threshold cost: <strong>¥${fmt(cTh)}</strong></div>
      <div>Ideal (−8%): <strong>¥${fmt(cId)}</strong></div>
      <div style="margin-top:6px">If your planned costs are…</div>
      <div>¥500,000 → ${badge(500000)}</div>
      <div>¥1,000,000 → ${badge(1000000)}</div>
      <div>¥1,500,000 → ${badge(1500000)}</div>
    `;
    // keep tooltip in view on phones
    if (window.innerWidth < 640){
      tooltip.style.display='block';
      tooltip.style.left = (sx(rent) + 10) + 'px';
      tooltip.style.top  = (sy(Math.min(cTh,cId)) - 10) + 'px';
      tooltip.innerHTML = `
        <div style="color:var(--muted);font-size:12px;margin-bottom:6px">At Rent <strong>¥${fmt(rent,0)}</strong> / mo</div>
        <div>Cost threshold: <strong>¥${fmt(cTh)}</strong></div>
        <div>Ideal (−8%): <strong>¥${fmt(cId)}</strong></div>
      `;
    }
  }

  // init + events
  render();
  window.addEventListener('resize', render);
  document.getElementById('rentIn').addEventListener('input', (e)=> updateForRent(Number(e.target.value||0)));
})();
</script>
</body>
</html>
