<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Rent (¥/mo) vs Initial Fixed Costs (¥)</title>
<style>
  :root{--bg:#0b1020;--ink:#e8f0ff;--muted:#9fb0d0;--grid:#1f2a44;--line:#60a5fa;--ideal:#34d399;
        --red:rgba(239,68,68,.25);--yellow:rgba(234,179,8,.25);--green:rgba(34,197,94,.25);
        --card-radius:16px;--shadow:0 10px 30px rgba(0,0,0,.35)}
  html,body{height:100%;background:radial-gradient(1200px 800px at 20% -10%,#12203a 0%,#091124 60%);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1100px;margin:20px auto;padding:0 16px}
  h1{margin:0 0 4px;font-size:clamp(20px,2.2vw,30px);font-weight:800}
  .sub{color:var(--muted);font-size:14px;line-height:1.4}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.07);border-radius:var(--card-radius);box-shadow:var(--shadow);padding:14px}
  .stage{display:grid;grid-template-columns:1fr 340px;gap:16px}
  @media(max-width:900px){.stage{grid-template-columns:1fr}}
  .chart-wrap{position:relative;width:100%;aspect-ratio:16/11;min-height:360px}
  svg{width:100%;height:100%;display:block;overflow:visible}
  .axis text{fill:var(--muted);font-size:12px}
  .axis path,.axis line{stroke:var(--grid);stroke-width:1}
  .grid line{stroke:var(--grid);stroke-width:1}
  .grid .major{opacity:.9}.grid .minor{opacity:.4}
  .line-main{stroke:var(--line);stroke-width:2.5;fill:none}
  .line-ideal{stroke:var(--ideal);stroke-width:2.5;stroke-dasharray:6 6;fill:none}
  .area-red{fill:var(--red)}.area-yellow{fill:var(--yellow)}.area-green{fill:var(--green)}
  .cursor-line{stroke:rgba(255,255,255,.5);stroke-dasharray:3 6;shape-rendering:crispEdges}
  .legend{display:grid;gap:10px;align-content:start}
  .legend .row{display:grid;grid-template-columns:16px 1fr;gap:10px;align-items:center;font-size:14px;color:var(--muted)}
  .sw{width:16px;height:16px;border-radius:4px;border:1px solid rgba(255,255,255,.25)}
  .sw.red{background:var(--red)}.sw.yellow{background:var(--yellow)}.sw.green{background:var(--green)}
  .keyline{height:1px;background:var(--grid);margin:8px 0}
  .foot{color:var(--muted);font-size:12px;margin-top:8px}
  .pill{display:inline-block;padding:.25rem .6rem;border-radius:999px;background:rgba(125,211,252,.12);border:1px solid rgba(125,211,252,.35)}
  .calc{display:grid;gap:10px}
  .calc label{font-size:13px;color:var(--muted)}
  .calc input[type=number]{width:100%;background:#0b1226;color:var(--ink);border:1px solid rgba(255,255,255,.18);border-radius:10px;padding:10px 12px;font-size:14px}
  .chips{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:6px}
  .chip{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.18);border-radius:999px;padding:6px 10px;font-size:12px;text-align:center;cursor:pointer}
  .chip:active{transform:translateY(1px)}
  .badge{padding:6px 10px;border-radius:10px;font-weight:700;font-size:12px;display:inline-block}
  .ok{background:rgba(34,197,94,.18);border:1px solid rgba(34,197,94,.5)}
  .warn{background:rgba(234,179,8,.18);border:1px solid rgba(234,179,8,.5)}
  .bad{background:rgba(239,68,68,.18);border:1px solid rgba(239,68,68,.5)}
  .tooltip{position:absolute;pointer-events:none;background:#0b1226;border:1px solid rgba(255,255,255,.16);border-radius:10px;padding:10px 12px;font-size:13px;color:var(--ink);box-shadow:var(--shadow);transform:translate(8px,-8px);white-space:nowrap}
  .marker{fill:white;stroke:#111827;stroke-width:2}
</style>
</head>
<body>
<div class="wrap">
  <h1>Rent (¥/mo) vs Initial Fixed Costs (¥)</h1>
  <div class="sub">
    Two budgets: <span class="pill">4,000,000</span> and <span class="pill">3,680,000</span>.
    Lines show <code>cost = budget − 24·rent</code>. Shading: Red (above 4,000,000), Yellow (between), Green (below 3,680,000).
  </div>

  <div class="stage">
    <div class="card">
      <div class="chart-wrap">
        <svg id="chart" role="img" aria-label="Initial fixed costs versus monthly rent in yen"></svg>
        <div id="tooltip" class="tooltip" style="display:none"></div>
      </div>
      <div class="foot">Axes: rent ¥120,000–¥160,000 (horizontal), costs ¥0–¥1,000,000 (vertical). Tap/hover to inspect.</div>
    </div>

    <aside class="card legend">
      <div class="row"><span class="sw red"></span><div><strong>Unacceptable</strong> — Above the ¥4,000,000 line</div></div>
      <div class="row"><span class="sw yellow"></span><div><strong>Caution</strong> — Between the lines</div></div>
      <div class="row"><span class="sw green"></span><div><strong>Ideal</strong> — At or below the ¥3,680,000 line</div></div>
      <div class="keyline"></div>

      <div style="font-size:14px;color:var(--muted);">Calculator</div>
      <div class="calc">
        <label for="rentIn">Rent (¥/mo)</label>
        <input id="rentIn" type="number" min="0" step="1000" value="140000" inputmode="numeric" />
        <label for="costIn">Planned costs (¥)</label>
        <input id="costIn" type="number" min="0" step="10000" value="500000" inputmode="numeric" />
        <div class="chips" id="chipRow"></div>
        <div id="readout" style="font-size:14px;line-height:1.6"></div>
      </div>
    </aside>
  </div>
</div>

<script>
(function(){
  // Ranges
  const rMin=120000,rMax=160000;   // X: rent
  const cMin=0,cMax=1000000;       // Y: costs

  // Lines
  const cost4m   = r => 4000000 - 24*r;
  const cost3680 = r => 3680000 - 24*r;

  const svg=document.getElementById('chart');
  const tooltip=document.getElementById('tooltip');
  const chipsEl=document.getElementById('chipRow');
  const rentEl=document.getElementById('rentIn');
  const costEl=document.getElementById('costIn');
  let dims, marker;

  const fmt=(n,d=0)=>Number(Number(n).toFixed(d)).toLocaleString('en-US',{minimumFractionDigits:d,maximumFractionDigits:d});
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

  // Build handy preset chips: ¥100k → ¥1,000k by ¥100k
  const presets=[...Array(10)].map((_,i)=> (i+1)*100000);
  chipsEl.innerHTML = presets.map(v=>`<div class="chip" data-v="${v}">¥${fmt(v)}</div>`).join('');
  chipsEl.onclick = (e)=> { const v = e.target.getAttribute?.('data-v'); if (v){ costEl.value = v; updateUI(); } };

  function measure(){
    const W = svg.clientWidth || svg.parentElement.clientWidth;
    const H = svg.clientHeight || svg.parentElement.clientHeight;
    const m = {top:20,right:20,bottom:64,left:96};
    if (innerWidth<480){ m.left=84; m.bottom=72; }
    return {W,H,m,innerW:Math.max(220,W-m.left-m.right),innerH:Math.max(220,H-m.top-m.bottom)};
  }
  const sx=r=>dims.m.left+((r-rMin)/(rMax-rMin))*dims.innerW;
  const sy=c=>dims.m.top+dims.innerH-((c-cMin)/(cMax-cMin))*dims.innerH;

  function add(tag,attrs={},kids=[]){const e=document.createElementNS('http://www.w3.org/2000/svg',tag);for(const[k,v]of Object.entries(attrs))e.setAttribute(k,v);kids.forEach(k=>e.appendChild(k));svg.appendChild(e);return e;}
  function E(tag,attrs={},kids=[]){const e=document.createElementNS('http://www.w3.org/2000/svg',tag);for(const[k,v]of Object.entries(attrs))e.setAttribute(k,v);kids.forEach(k=>e.appendChild(k));return e;}
  const pathD=pts=>'M'+pts.map(p=>p.map(v=>+v.toFixed(2)).join(',')).join(' L ');
  function clear(){ while(svg.firstChild) svg.removeChild(svg.firstChild); }

  // Helper: make a cropped line within the plot (no sticking to edges)
  function croppedLinePoints(budgetFn){
    // Solve for rent where cost == cMax and cost == cMin
    // cost = B - 24*r
    // r_at_top = (B - cMax)/24
    // r_at_bottom = B/24
    const B = budgetFn(0) + 24*0; // intercept when r=0
    let r0 = (B - cMax)/24;      // where line enters from top
    let r1 = (B - cMin)/24;      // where it hits bottom

    // Constrain to viewport and to [rMin,rMax]
    const start = clamp(r0, rMin, rMax);
    const end   = clamp(r1, rMin, rMax);

    if (end <= rMin || start >= rMax || start >= end) {
      // No visible segment in the viewport
      return [];
    }
    const N=180;
    const rents = Array.from({length:N+1},(_,i)=> start + i*(end-start)/N);
    return rents.map(r=>[ sx(r), sy(clamp(budgetFn(r), cMin, cMax)) ]);
  }

  function render(){
    dims=measure(); clear();
    const {m,innerW,innerH}=dims;

    // Clip area
    const defs = add('defs');
    defs.appendChild(E('clipPath',{id:'clipA'},[E('rect',{x:m.left,y:m.top,width:innerW,height:innerH,rx:2})]));

    // Grid
    const gGrid=add('g',{class:'grid',clip-path:'url(#clipA)'});
    for(let r=rMin;r<=rMax;r+=5000){const x=sx(r);gGrid.appendChild(E('line',{x1:x,y1:m.top,x2:x,y2:m.top+innerH,class:r%10000===0?'major':'minor'}));}
    for(let c=cMin;c<=cMax;c+=250000){const y=sy(c);gGrid.appendChild(E('line',{x1:m.left,y1:y,x2:m.left+innerW,y2:y,class:c%500000===0?'major':'minor'}));}

    // Axes
    const ax=add('g',{class:'axis'});
    ax.appendChild(E('line',{x1:m.left,y1:m.top+innerH,x2:m.left+innerW,y2:m.top+innerH}));
    for(let r=rMin;r<=rMax;r+=10000){const x=sx(r);ax.appendChild(E('line',{x1:x,y1:m.top+innerH,x2:x,y2:m.top+innerH+6}));ax.appendChild(E('text',{x:x,y:m.top+innerH+22,'text-anchor':'middle'})).textContent='¥'+fmt(r);}
    ax.appendChild(E('text',{x:m.left+innerW/2,y:m.top+innerH+42,'text-anchor':'middle'})).textContent='Rent per Month (¥)';
    ax.appendChild(E('line',{x1:m.left,y1:m.top,x2:m.left,y2:m.top+innerH}));
    for(let c=cMin;c<=cMax;c+=500000){const y=sy(c);ax.appendChild(E('line',{x1:m.left-6,y1:y,x2:m.left,y2:y}));ax.appendChild(E('text',{x:m.left-10,y:y+4,'text-anchor':'end'})).textContent='¥'+fmt(c);}
    ax.appendChild(E('text',{transform:`translate(${m.left-68} ${m.top+innerH/2}) rotate(-90)`,'text-anchor':'middle'})).textContent='Initial Fixed Costs (¥)';

    // Lines (cropped)
    const pts4m   = croppedLinePoints(r => 4000000 - 24*r);
    const pts3680 = croppedLinePoints(r => 3680000 - 24*r);

    // Areas (clip keeps them inside)
    const N=360; const rents=Array.from({length:N+1},(_,i)=> rMin+i*(rMax-rMin)/N);
    const poly4 = rents.map(r=>[sx(r), sy(clamp(4000000-24*r,cMin,cMax))]);
    const poly3 = rents.map(r=>[sx(r), sy(clamp(3680000-24*r,cMin,cMax))]);
    const gAreas = add('g',{clip-path:'url(#clipA)'});
    gAreas.appendChild(E('path',{d:pathD([ ...poly4, [sx(rMax),sy(cMax)],[sx(rMin),sy(cMax)] ]),class:'area-red'}));
    gAreas.appendChild(E('path',{d:pathD([ ...poly4, ...poly3.slice().reverse() ]),class:'area-yellow'}));
    gAreas.appendChild(E('path',{d:pathD([ ...poly3, [sx(rMax),sy(cMin)],[sx(rMin),sy(cMin)] ]),class:'area-green'}));

    // Draw cropped lines
    const gLines = add('g',{clip-path:'url(#clipA)'});
    if (pts4m.length)   gLines.appendChild(E('path',{d:pathD(pts4m),class:'line-main','aria-label':'cost = 4,000,000 − 24·rent'}));
    if (pts3680.length) gLines.appendChild(E('path',{d:pathD(pts3680),class:'line-ideal','aria-label':'cost = 3,680,000 − 24·rent'}));

    // Interaction
    const overlay=add('rect',{x:m.left,y:m.top,width:innerW,height:innerH,fill:'transparent',style:'cursor:crosshair'});
    const cursor=add('line',{class:'cursor-line',x1:m.left,x2:m.left,y1:m.top,y2:m.top+innerH,opacity:0});
    overlay.addEventListener('pointerenter',()=>{cursor.setAttribute('opacity','1');tooltip.style.display='block';});
    overlay.addEventListener('pointerleave',()=>{cursor.setAttribute('opacity','0');tooltip.style.display='none';});
    overlay.addEventListener('pointermove',e=>{
      const rect=svg.getBoundingClientRect();
      const cx=clamp(e.clientX-rect.left, m.left, m.left+innerW);
      const rent=rMin+((cx-m.left)/innerW)*(rMax-rMin);
      const c4=4000000-24*rent, c3=3680000-24*rent;
      cursor.setAttribute('x1',cx); cursor.setAttribute('x2',cx);
      tooltip.innerHTML=`<div style="color:var(--muted);font-size:12px;margin-bottom:6px">Rent <strong>¥${fmt(rent,0)}</strong> / mo</div>
                         <div>Cost @ 4,000,000: <strong>¥${fmt(c4)}</strong></div>
                         <div>Cost @ 3,680,000: <strong>¥${fmt(c3)}</strong></div>`;
      tooltip.style.left=(cx+10)+'px';
      tooltip.style.top=(sy(Math.min(clamp(c4,cMin,cMax),clamp(c3,cMin,cMax)))-10)+'px';
    });

    // Marker for calculator
    marker=add('circle',{cx:sx(rMin),cy:sy(cMin),r:5,class:'marker',opacity:.95});
    updateUI();
  }

  function statusBadge(cost, rent){
    const th4 = 4000000 - 24*rent;
    const th3 = 3680000 - 24*rent;
    if (cost <= th3) return '<span class="badge ok">Ideal</span>';
    if (cost <= th4) return '<span class="badge warn">Caution</span>';
    return '<span class="badge bad">Unacceptable</span>';
  }

  function updateUI(){
    const rent = Number(rentEl.value||0);
    const planned = Number(costEl.value||0);

    // Move marker to 4,000,000 line at this rent (clamped to Y range)
    if (marker){
      marker.setAttribute('cx', sx(clamp(rent,rMin,rMax)));
      marker.setAttribute('cy', sy(clamp(4000000 - 24*rent, cMin, cMax)));
    }

    const c4 = 4000000 - 24*rent;
    const c3 = 3680000 - 24*rent;

    document.getElementById('readout').innerHTML = `
      <div>Cost @ 4,000,000: <strong>¥${fmt(c4)}</strong></div>
      <div>Cost @ 3,680,000: <strong>¥${fmt(c3)}</strong></div>
      <div style="margin-top:8px">Planned costs: <strong>¥${fmt(planned)}</strong> → ${statusBadge(planned, rent)}</div>
    `;
  }

  // Boot
  function sx(r){ return dims.m.left+((r-rMin)/(rMax-rMin))*dims.innerW; }
  function sy(c){ return dims.m.top+dims.innerH-((c-cMin)/(cMax-cMin))*dims.innerH; }
  render();
  addEventListener('resize', render);
  rentEl.addEventListener('input', updateUI);
  costEl.addEventListener('input', updateUI);
})();
</script>
</body>
</html>
